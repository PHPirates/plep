# Maintainers: Abby and Thomas at abbythomasorganisation@gmail.com
pkgname=plep
pkgver=v1.2.4
pkgrel=1
epoch=
pkgdesc=" An agenda for planning a few tasks per day right on your desktop."
arch=('any')
url="https://github.com/deltadak/plep"
license=('MIT')
groups=()
depends=('java-openjfx' 'jre8-openjdk')
makedepends=()
checkdepends=()
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
changelog=
source=("${pkgname}-source::git+https://github.com/deltadak/plep.git")
noextract=()
md5sums=('SKIP')
validpgpkeys=()

build() {
	# Bash commands to build the software
	# makepkg cd's to src before build()
	cd $pkgname-source
	./gradlew build
}

check() {
    cd $pkgname-source
	./gradlew check
}

package() {
	# The compiled files have to be in pkg, replicating the root hierarchy
	# We will install the jar in /usr/lib and a file which runs the jar in /usr/bin so it will be (probably in most cases) in PATH. This setup is reverse-engineered from firefox.
	mkdir -p "$pkgdir/usr/lib/$pkgname"
	mkdir -p "$pkgdir/usr/bin"

	# Copy the jar that we have build
	cp $pkgname-source/build/libs/$pkgname-$pkgver.jar $pkgdir/usr/lib/$pkgname

    # Copy an empty database so we can set permissions on it
    cp $pkgname-source/build/classes/java/plep.db $pkgdir/usr/lib/$pkgname

    # Create a file with a command to execute the jar
	echo "#!/bin/sh
java -jar /usr/lib/$pkgname/$pkgname-$pkgver.jar" > $pkgdir/usr/bin/$pkgname

    # Since git only saves execute and not write permissions, we have to set it manually.
    # We have to make both the database and folder containing it writable in order to create a writable database
    chmod a+w $pkgdir/usr/lib/$pkgname
    chmod a+x $pkgdir/usr/lib/$pkgname/$pkgname-$pkgver.jar
    chmod a+w $pkgdir/usr/lib/$pkgname/plep.db
    chmod a+x $pkgdir/usr/bin/$pkgname
}

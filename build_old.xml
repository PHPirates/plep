<?xml version="1.0" encoding="UTF-8"?>
<!-- adapted from https://github.com/mplacona/java-junit-template-project -->
<project name="plep" default="test" basedir=".">
    <property name="main.build.dir" value="build/main" />
    <property name="main.src.dir" value="src" />
    <property name="test.build.dir" value="build/test" />
    <property name="test.src.dir" value="test" />
    <property name="lib.dir" value="lib"/>

    <path id="classpath.base" />

    <!-- JavaC2 needed for JavaFX -->
    <property name="javac2.home" value="lib/javac2" />
    <path id="javac2.classpath">
        <pathelement location="${javac2.home}/javac2.jar"/>
        <pathelement location="${javac2.home}/jdom.jar"/>
        <pathelement location="${javac2.home}/asm-all.jar"/>
        <pathelement location="${javac2.home}/jgoodies-forms.jar"/>
    </path>

    <!-- put things we need on the path -->
    <path id="classpath">
        <!-- Include all libraries we have. -->
        <fileset dir="${lib.dir}" includes="**/*.jar"/>
        <!--<pathelement location="lib/junit.jar" />-->
        <!-- not completely sure if this one is needed or what it does -->
        <!--<pathelement location="lib/hamcrest-core-1.3.jar" />-->
        <pathelement location="${main.build.dir}" />
        <path refid="classpath.base" />
    </path>

    <target name="test" depends="run-tests, clean" />

    <target name="compile">
        <mkdir dir="${main.build.dir}" />
        <!-- copied from generated register.custom.compilers, to include javac2 -->
        <taskdef name="javac2" classname="com.intellij.ant.Javac2" classpathref="javac2.classpath"/>
        <taskdef name="instrumentIdeaExtensions" classname="com.intellij.ant.InstrumentIdeaExtensions" classpathref="javac2.classpath"/>

        <!-- Compile using javac2, not javac compiler -->
        <javac2 srcdir="${main.src.dir}" destdir="${main.build.dir}" includeantruntime="false">
            <classpath refid="classpath" />
        </javac2>
        <echo message="Compile source."/>
    </target>

    <!-- Specify what to do to build, using javac-->
    <target name="compile-tests" depends="compile">
        <mkdir dir="${test.build.dir}" />
        <javac2 srcdir="${test.src.dir}" destdir="${test.build.dir}" includeantruntime="false">
            <classpath refid="classpath"/>
        </javac2>
        <echo message="Compiled tests."/>
    </target>

    <!-- Test and build all files  -->
    <!-- To run this: use "ant" (default) or "ant run" -->
    <target name="run-tests" depends="compile-tests">
        <junit printsummary="on" haltonfailure="yes" fork="true">
            <classpath>
                <path refid="classpath"/>
                <pathelement location="${test.build.dir}"/>
            </classpath>
            <formatter type="brief" usefile="false"/>
            <batchtest>
                <fileset dir="${test.src.dir}" includes="**/*Test*.java"/>
            </batchtest>
        </junit>
        <echo message="Run tests."/>
    </target>

    <!-- delete all class files -->
    <!-- To run this: use "ant clean" -->
    <target name="clean">
        <delete>
            <fileset dir="${basedir}" includes="**/*.class" />
        </delete>
        <echo message="clean done" />
    </target>

</project>